# ntfy-macos Configuration Examples
# Copy relevant sections to ~/.config/ntfy-macos/config.yml
#
# Note: Unknown keys in your config will trigger a warning in the menu bar.
# This helps catch typos like "icon_path" vs "iconpath" or misplaced options.

# Enable local notification server on localhost (optional)
# Scripts can POST to http://127.0.0.1:9292/notify to trigger notifications
# local_server_port: 9292

servers:
  # ===========================================
  # Home Automation (Home Assistant)
  # ===========================================
  - url: https://ntfy.sh
    # Security: only allow homeassistant:// and https URLs
    # Note: allowed_schemes REPLACES defaults - http is blocked here
    allowed_schemes:
      - https
      - homeassistant
    topics:
      - name: homeassistant-alerts
        icon_path: /Users/you/icons/homeassistant.png
        actions:
          - title: "Open Home Assistant"
            type: view
            url: "homeassistant://"
          - title: "View Cameras"
            type: view
            url: "homeassistant://navigate/lovelace/cameras"

  # ===========================================
  # CI/CD Pipeline Notifications
  # ===========================================
  # IMPORTANT: Use a private server with authentication for script actions
  # Never use auto_run_script or script actions with public ntfy.sh
  - url: https://ntfy.yourcompany.com
    token: tk_cicd_token
    topics:
      - name: github-actions
        icon_symbol: hammer.fill
        actions:
          - title: "Open GitHub"
            type: view
            url: "https://github.com/youruser/yourrepo/actions"
          - title: "Deploy"
            type: script
            path: /usr/local/bin/deploy.sh

      - name: gitlab-ci
        icon_symbol: arrow.triangle.branch
        actions:
          - title: "Open Pipeline"
            type: view
            url: "https://gitlab.com/yourgroup/yourproject/-/pipelines"

  # ===========================================
  # Server Monitoring
  # ===========================================
  - url: https://ntfy.myserver.com
    token: tk_yourtoken
    topics:
      - name: server-alerts
        icon_symbol: server.rack
        actions:
          - title: "SSH to Server"
            type: script
            path: /usr/local/bin/open-ssh.sh
          - title: "View Grafana"
            type: view
            url: "https://grafana.myserver.com"

      - name: disk-alerts
        icon_symbol: externaldrive.fill
        auto_run_script: /usr/local/bin/disk-cleanup.sh
        actions:
          - title: "View Dashboard"
            type: view
            url: "https://grafana.myserver.com/d/disk"

  # ===========================================
  # NAS / Synology
  # ===========================================
  - url: https://ntfy.sh
    topics:
      - name: synology
        icon_path: /Users/you/icons/synology.png
        actions:
          - title: "Open DSM"
            type: view
            url: "https://nas.local:5001"
          - title: "Download Station"
            type: view
            url: "https://nas.local:5001/webman/index.cgi?launchApp=SYNO.SDS.DownloadStation.Application"

  # ===========================================
  # Package Updates (view only - safe for public server)
  # ===========================================
  - url: https://ntfy.sh
    topics:
      - name: yt-dlp-releases
        icon_symbol: arrow.down.circle.fill
        click_url: "https://github.com/yt-dlp/yt-dlp/releases"

      - name: homebrew-updates
        icon_symbol: mug.fill
        actions:
          - title: "View Changelog"
            type: view
            url: "https://github.com/Homebrew/brew/releases"

  # ===========================================
  # Package Updates (with auto-update scripts - private server)
  # ===========================================
  - url: https://ntfy.home.local
    token: tk_updates_token
    topics:
      - name: yt-dlp-releases
        icon_symbol: arrow.down.circle.fill
        auto_run_script: /usr/local/bin/update-yt-dlp.sh

      - name: homebrew-updates
        icon_symbol: mug.fill
        auto_run_script: /usr/local/bin/brew-upgrade.sh

  # ===========================================
  # Security Alerts (private server required for scripts)
  # ===========================================
  - url: https://ntfy.secure.local
    token: tk_security_token
    topics:
      - name: security-alerts
        icon_symbol: lock.shield.fill
        actions:
          - title: "View Logs"
            type: script
            path: /usr/local/bin/view-security-logs.sh
          - title: "Block IP"
            type: script
            path: /usr/local/bin/block-ip.sh

  # ===========================================
  # Background Processing (Silent) - private server required
  # ===========================================
  - url: https://ntfy.home.local
    token: tk_automation_token
    topics:
      - name: backup-trigger
        silent: true
        auto_run_script: /usr/local/bin/run-backup.sh

      - name: sync-trigger
        silent: true
        auto_run_script: /usr/local/bin/sync-files.sh

  # ===========================================
  # Smart Home Devices (private server for script actions)
  # ===========================================
  - url: https://ntfy.home.local
    token: tk_smarthome_token
    topics:
      - name: doorbell
        icon_symbol: video.doorbell.fill
        actions:
          - title: "View Camera"
            type: view
            url: "https://cameras.home.local/doorbell"
          - title: "Unlock Door"
            type: script
            path: /usr/local/bin/unlock-door.sh

      - name: garage
        icon_symbol: car.fill
        actions:
          - title: "Open Garage"
            type: script
            path: /usr/local/bin/garage-toggle.sh

  # ===========================================
  # Development Tools (private server for script actions)
  # ===========================================
  - url: https://ntfy.dev.local
    token: tk_dev_token
    topics:
      - name: build-complete
        icon_symbol: checkmark.circle.fill
        actions:
          - title: "Open Xcode"
            type: view
            url: "xcode://"
          - title: "Run Tests"
            type: script
            path: /usr/local/bin/run-tests.sh

      - name: pr-review
        icon_symbol: arrow.triangle.pull
        actions:
          - title: "Open PR"
            type: view
            url: "https://github.com/pulls"

  # ===========================================
  # macOS Shortcuts Integration
  # ===========================================
  - url: https://ntfy.home.local
    token: tk_shortcuts_token
    topics:
      - name: automation
        icon_symbol: wand.and.stars
        actions:
          - title: "Run Shortcut"
            type: shortcut
            name: "My Automation Shortcut"
          - title: "Focus Mode"
            type: shortcut
            name: "Toggle Focus Mode"

  # ===========================================
  # AppleScript Actions
  # ===========================================
  - url: https://ntfy.home.local
    token: tk_applescript_token
    topics:
      - name: media-control
        icon_symbol: play.circle.fill
        actions:
          # Inline AppleScript
          - title: "Pause Music"
            type: applescript
            script: 'tell application "Music" to pause'
          # AppleScript file
          - title: "Run Workflow"
            type: applescript
            path: /Users/you/Scripts/workflow.scpt

  # ===========================================
  # Fetch Missed Messages
  # ===========================================
  # Fetch messages that arrived while the app was not running
  - url: https://ntfy.myserver.com
    token: tk_yourtoken
    fetch_missed: true  # Enable for all topics on this server
    topics:
      - name: important-alerts
        icon_symbol: exclamationmark.triangle.fill
      - name: low-priority
        fetch_missed: false  # Override: disable for this topic

  # ===========================================
  # URL Security (allowed_schemes & allowed_domains)
  # ===========================================
  # Restrict which URLs can be opened from notifications
  - url: https://ntfy.sh
    # Only allow https URLs to specific domains
    allowed_schemes:
      - https
    allowed_domains:
      - github.com
      - "*.example.com"  # Wildcards supported
    topics:
      - name: restricted-alerts
        icon_symbol: lock.fill
        click_url: "https://github.com/myorg/myrepo"

  # Allow custom app schemes (e.g., Home Assistant)
  - url: https://ntfy.home.local
    allowed_schemes:
      - https
      - homeassistant
      - ssh  # Allow ssh:// URLs
    topics:
      - name: home-automation
        icon_symbol: house.fill
        click_url: "homeassistant://"
